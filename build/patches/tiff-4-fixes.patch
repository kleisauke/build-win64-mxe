From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Kleis Auke Wolthuizen <github@kleisauke.nl>
Date: Sun, 7 Mar 2021 21:30:00 +0100
Subject: [PATCH 1/1] Fix pkg-config Libs.private for static linking


diff --git a/CMakeLists.txt b/CMakeLists.txt
index 1111111..2222222 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -668,16 +668,6 @@ if (check-ycbcr-subsampling)
   set(CHECK_JPEG_YCBCR_SUBSAMPLING 1)
 endif()
 
-# Generate pkg-config file
-set(prefix "${CMAKE_INSTALL_PREFIX}")
-set(exec_prefix "${CMAKE_INSTALL_PREFIX}")
-set(libdir "${CMAKE_INSTALL_FULL_LIBDIR}")
-set(includedir "${CMAKE_INSTALL_FULL_INCLUDEDIR}")
-configure_file(${CMAKE_CURRENT_SOURCE_DIR}/libtiff-4.pc.in
-               ${CMAKE_CURRENT_BINARY_DIR}/libtiff-4.pc)
-install(FILES ${CMAKE_CURRENT_BINARY_DIR}/libtiff-4.pc
-        DESTINATION "${CMAKE_INSTALL_FULL_LIBDIR}/pkgconfig")
-
 # Includes used by libtiff (and tests)
 if(ZLIB_INCLUDE_DIRS)
   list(APPEND TIFF_INCLUDES ${ZLIB_INCLUDE_DIRS})
@@ -706,34 +696,55 @@ endif()
 
 # Libraries required by libtiff
 set(TIFF_LIBRARY_DEPS)
+set(TIFF_LIBS)
 if(NOT MINGW AND M_LIBRARY)
   list(APPEND TIFF_LIBRARY_DEPS "m")
+  list(APPEND TIFF_LIBS "-lm")
 endif()
 if(ZLIB_LIBRARIES)
   list(APPEND TIFF_LIBRARY_DEPS ${ZLIB_LIBRARIES})
+  list(APPEND TIFF_LIBS "-lz")
 endif()
 if(DEFLATE_LIBRARIES)
   list(APPEND TIFF_LIBRARY_DEPS ${DEFLATE_LIBRARIES})
+  list(APPEND TIFF_LIBS "-ldeflate")
 endif()
 if(JPEG_LIBRARIES)
   list(APPEND TIFF_LIBRARY_DEPS ${JPEG_LIBRARIES})
+  list(APPEND TIFF_LIBS "-ljpeg")
 endif()
 if(JPEG12_LIBRARIES)
   list(APPEND TIFF_LIBRARY_DEPS ${JPEG12_LIBRARIES})
 endif()
 if(JBIG_LIBRARIES)
   list(APPEND TIFF_LIBRARY_DEPS ${JBIG_LIBRARIES})
+  list(APPEND TIFF_LIBS "-ljbig")
 endif()
 if(LIBLZMA_LIBRARIES)
   list(APPEND TIFF_LIBRARY_DEPS ${LIBLZMA_LIBRARIES})
+  list(APPEND TIFF_LIBS "-llzma")
 endif()
 if(ZSTD_LIBRARIES)
   list(APPEND TIFF_LIBRARY_DEPS ${ZSTD_LIBRARIES})
+  list(APPEND TIFF_LIBS "-lzstd")
 endif()
 if(WEBP_LIBRARIES)
   list(APPEND TIFF_LIBRARY_DEPS ${WEBP_LIBRARIES})
+  list(APPEND TIFF_LIBS "-lwebp")
 endif()
 
+# Generate pkg-config file
+set(prefix "${CMAKE_INSTALL_PREFIX}")
+set(exec_prefix "${CMAKE_INSTALL_PREFIX}")
+set(libdir "${CMAKE_INSTALL_FULL_LIBDIR}")
+set(includedir "${CMAKE_INSTALL_FULL_INCLUDEDIR}")
+string (REPLACE ";" " " tiff_libs_private "${TIFF_LIBS}")
+configure_file(${CMAKE_CURRENT_SOURCE_DIR}/libtiff-4.pc.in
+               ${CMAKE_CURRENT_BINARY_DIR}/libtiff-4.pc)
+install(FILES ${CMAKE_CURRENT_BINARY_DIR}/libtiff-4.pc
+        DESTINATION "${CMAKE_INSTALL_FULL_LIBDIR}/pkgconfig")
+
+
 #report_values(TIFF_INCLUDES TIFF_LIBRARY_DEPS)
 
 # Process subdirectories
